
<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
	<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>CS:GODOT</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="Free HTML5 Website Template by FreeHTML5.co" />
	<meta name="keywords" content="free html5, free template, free bootstrap, free website template, html5, css3, mobile first, responsive" />
	<meta name="author" content="FreeHTML5.co" />

  	<!-- Facebook and Twitter integration -->
	<meta property="og:title" content=""/>
	<meta property="og:image" content=""/>
	<meta property="og:url" content=""/>
	<meta property="og:site_name" content=""/>
	<meta property="og:description" content=""/>
	<meta name="twitter:title" content="" />
	<meta name="twitter:image" content="" />
	<meta name="twitter:url" content="" />
	<meta name="twitter:card" content="" />

	<!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
	<link rel="shortcut icon" href="favicon.ico">

	<link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700" rel="stylesheet">

	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">
  	<script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js" integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script>
  	<script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
	
	<!-- Animate.css -->
	<link rel="stylesheet" href="css/animate.css">
	<!-- Icomoon Icon Fonts-->
	<link rel="stylesheet" href="css/icomoon.css">
	<!-- Bootstrap  -->
	<link rel="stylesheet" href="css/bootstrap.css">
	<!-- Flexslider  -->
	<link rel="stylesheet" href="css/flexslider.css">
	<!-- Theme style  -->
	<link rel="stylesheet" href="css/style.css">

	<!-- Modernizr JS -->
	<script src="js/modernizr-2.6.2.min.js"></script>
	<!-- FOR IE9 below -->
	<!--[if lt IE 9]>
	<script src="js/respond.min.js"></script>
	<![endif]-->

	</head>
	<body>
	<div id="fh5co-page">
		<a href="#" class="js-fh5co-nav-toggle fh5co-nav-toggle"><i></i></a>
		<aside id="fh5co-aside" role="complementary" class="border js-fullheight">

			<h1 id="fh5co-logo"><a href="index.html">CS:GODOT</a></h1>
			<nav id="fh5co-main-menu" role="navigation">
				<ul>
					<li><a href="index.html">Overview</a></li>
					<li><a href="proposal.html">Proposal</a></li>
					<li><a href="milestone.html">Milestone</a></li>
					<li class="fh5co-active"><a href="final.html">Final</a></li>
				</ul>
			</nav>

			<div class="fh5co-footer">
				<ul>
					<li><a href="#"><i class="fa fa-github"></i></a></li>
				</ul>
			</div>

		</aside>

		<div id="fh5co-main">
			<div class="fh5co-narrow-content">
				<div class="row row-bottom-padded-md">
					<div class="col-md-10">
						<img src="images/final_cover_photo.png" alt ="final cover photo" style="width: 60%; display:block; margin:auto;"/>
				 	</div>
				</div>
				<div class="row row-bottom-padded-md">
					<div class="col-md-10 animate-box" data-animate-effect="fadeInLeft">
						<h2 class="fh5co-heading">Summary</h2>
						<p>CS:GODOT is a realtime multiplayer first person shooter game, inspired by the recent announcement of Counter-Strike 2. In the announcement, it was revealed that Counter-Strike 2 would introduce volumetric smoke grenades. This was a vast improvement over the previous game, Counter-Strike Global Offensive. After hearing this announcement, we felt inspired to implement something similar. CS:GODOT is a deathmatch style game that allows players to shoot and throw smoke and frag grenades. The smoke grenades create volumetric smoke that the player can interact with. We relied on kinematic equations for player movement and grenade trajectories. We textured and animated character models using Blender. Using Godot’s Volumetric Fog, which is based on Wronski’s “Volumetric Fog: Unified Compute Shader-Based Solution To Atmospheric Scattering”, we created fog volumes and added textures and shaders to make it look realistic.</p>
					</div>
				</div>
				<div class="row row-bottom-padded-md">
					<div class="col-md-10 animate-box" data-animate-effect="fadeInLeft">
						<h2 class="fh5co-heading">Kinematics</h2>
						<p>In order to handle player input and simulate semi-realistic movement, we relied on kinematic equations and Godot’s <i>move_and_slide</i> function, which handles bouncing and sliding, given an input velocity. More specifically, we found the direction moved for a given timestamp and calculated the velocity based on the direction and a set speed. To account for acceleration and to make the movement smoother, we linearly interpolated the calculated velocity with the past timestamp’s velocity, using acceleration as the weight. To find the direction the player is moving in, we utilized Godot's built in transform basis.</p>
						<pre><code>
direction = Vector3(0, 0, 0)
if move_forward:
	direction -= transform.basis.z
elif move_backward:
	direction += transform.basis.z
if move_left:
	direction -= transform.basis.x
if move_right:
	direction += transform.basis.x
						</code></pre>
						<img src="images/latex/velocity.png" alt="latex for calculation of current velocity"/>
						<p>We handled jumping by increasing the velocity in the y-axis and applying gravity to ensure that the player would land again. When the player jumps, we set their velocity in the y-axis to our defined jump velocity. To apply gravity, we apply the following equation:</p>
						<img src="images/latex/jump_gravity.png" alt="latex for jumping gravity"/>
						<p>To handle throwing grenades, we utilized Godot’s RigidBody3D object, which makes it easy to apply 3D physics. We first found the current position of the player and from that position, we spawned a grenade instance and called Godot’s <i>apply_impulse</i> function, which applies a force in a specified direction.</p>
					</div>
				</div>
				<div class="row row-bottom-padded-md">
					<div class="col-md-10 animate-box" data-animate-effect="fadeInLeft">
						<h2 class="fh5co-heading">Texturing</h2>
						<p>We were able to find the actual models used in CS:GO by decompiling the game’s resources and importing them into Blender. We were also able to find the textures used using the same process. However, this meant that we had to manually texture the models ourselves. Luckily, one of our members had experience in texturing 3D models in the past. Utilizing what we learned in class, we utilized BSDF materials, bump maps, and bilinear filtering in Blender to create realistic renders of the player and weapon models.</p>
						<img class="col-md-10" src="images/t_model_rendered.png" alt="t_model rendered"/>
						<img class="col-md-10" src="images/t_model_nodes.png" alt="t_model nodes"/>
					</div>
				</div>
				<div class="row row-bottom-padded-md">
					<div class="col-md-10 animate-box" data-animate-effect="fadeInLeft">
						<h2 class="fh5co-heading">Animating</h2>
						<p>We implemented the weapon reload and death animations in Blender to provide a more realistic feel to our game. This was accomplished by utilizing Blender’s rigging and animating system. We utilized Blender’s armature object, which allows us to apply “bones” to certain portions of the model so that we could control them during animating. Then we created keyframes for certain parts of the animations and then interpolated the in-between frames using Bezier interpolation.</p>
						<img class="col-md-10" src="images/t_model_animation.png" alt="t_model animation"/>
						<img class="col-md-10" src="images/reload.gif" alt="reload"/>
						<img class="col-md-10" src="images/death_animation.gif" alt="reload"/>
					</div>
				</div>
				<div class="row row-bottom-padded-md">
					<div class="col-md-10 animate-box" data-animate-effect="fadeInLeft">
						<h2 class="fh5co-heading">Smokes</h2>
						<p>To implement CS:GO style smokes, we used the volumetric fog nodes that were recently added in Godot 4.0. Using the correct shaders, we were able to give the volumetric fog an appearance similar to realistic fog by adding simplex noise and modifying the smoke to rise slowly. Initially, we implemented the smoke grenade by creating a singular spherical volumetric fog at the location of the grenade but quickly realized that the smoke would pass through solid objects. To fix this problem, we began by creating smaller smoke spheres at the location of the grenade, then using a custom flood fill algorithm to fill the volume of the surrounding area while still maintaining a generally spherical shape. After we got our volumetric smoke implementation working, we implemented the new CS2 frag grenades which are capable of dispelling smoke after they explode. To do this, we used Godot’s negative fog density which effectively can be used to defog any area that has fog density already. Then, we used this same feature to implement bullet wakes, in which when bullets pass through the smoke, we create a cylinder of negative density fog in order to dispel the smoke in the bullet's path. Doing some math we computed the location, direction, and length of the cylinders in order for it to follow the raytracer. Tweaking the different smoke-created parameters allowed us to get some pretty exciting and realistic results that were pretty similar to CS2’s smoke features.
	</p>
					</div>
				</div>
				<div class="row row-bottom-padded-md">
					<div class="col-md-10 animate-box" data-animate-effect="fadeInLeft">
						<h2 class="fh5co-heading">Multiplayer</h2>
						<p>All of the features mentioned above also work for multiplayer. This includes seeing other players’ movements, interacting with grenades, and shooting and receiving damage from other players. This was achieved by utilizing Godot’s MultiplayerSpawner and MultiplayerSychronizer nodes. We also used RPC calls to communicate between the client and the server.
</p>
					</div>
				</div>
				<div class="row row-bottom-padded-md">
					<div class="col-md-10 animate-box" data-animate-effect="fadeInLeft">
						<h2 class="fh5co-heading">Problems Encountered</h2>
						<p>A problem that we encountered was creating animations for the weapon, specifically creating keyframe animations. No one in the group had experience with rigging and animating so we had to search for tutorials to learn. Another issue that we encountered was spawning grenades with a realistic trajectory and making sure that their positions were absolute positions. Initially, the grenades were all being spawned as child instances of the player, which meant that the grenades were also moving with the player, even after they were thrown. We fixed this issue by spawning grenades as the world environment inside, which ensured that their positions would not be affected by the positions of the players. Another problem we encountered was correctly mapping collision layers for the various objects in our scene. We didn’t want our players to collide with the grenades because they were being spawned within the player’s hitbox. </p>
						<p>Another problem we encountered when adding recoil was how to implement camera shake to make it look more realistic. More specifically, we had trouble shaking the camera without changing the position of the raycast after the player stopped firing. To ensure that the crosshair was still an accurate representation of the raycast, we rotated the raycast by some amount, waited a split second, then rotated it again by the same amount in the other direction. This ensured that the position of the raycast was unchanged and that the player could actually see the visual effects of the camera shake. In order to calculate the amount of recoil that would affect the camera and raycast, we used a Monte-Carlo estimator over a random number generator. We found this to be the best way to generate randomness in the recoil while maintaining a level of accuracy and controllability. On top of that, we used a timer to measure the time between each shot. As the time between each shot decreases, the recoil increases because each shot is being fired in quicker succession, so it makes sense that the recoil should be more punishing in that situation. On the other hand, allowing more time between each shot significantly reduces recoil, which is supposed to reward the player for trying to be more precise.</p>
						<p>One problem we encountered was when trying to create cylinders in order to implement bullet wakes. We tried to lengthen the cylinder by extending it in the Z direction, however eventually discovered after a lot of blood, sweat, and testing that cylinders cannot be extended in the Z direction for some reason and may only be extended in the Y direction, perhaps to maintain the circular shape of the cylinder. In the process of trying to debug, we also discovered a few interesting bugs in which certain variables were sometimes updated unexpectedly and passed by reference rather than by value.</p>
						<p>As aforementioned in the smoke section, we found the realistic space-filling implementation to be particularly tricky. At first, we ran into many issues with object detection and figuring out how to actually place the smaller smoke spheres in places without any other objects. Implementing the flood fill algorithm proved to be a Leetcode-like exercise, but careful attention to the order in which the smaller smoke spheres are created was vital to making a realistic implementation. For this, we wanted to use a priority queue, however, we discovered that there was no priority queue. Rather than implementing it ourselves, we decided to opt for the simpler strategy of sorting a list of locations to place smokes from closest to farthest. Though this is the more inefficient method, there are really only so many smokes that are needed to be small so it is close to constant speed every time anyways. In addition, we spaced out the spawning of the smoke over a few frames in order to create a more realistic and natural appearance of the smoke grenade.</p>

						<p>Lastly, when testing out our shooting implementation, we discovered that while holding down left click didn’t continue to fire the weapon, if we moved our mouse around at the same time, it would fire impossibly fast and empty the magazine almost instantly. We found out that this was because our program will also check for any mouse clicks when it detects mouse movement, so by moving our mouse while holding left click, we unintentionally called the fire function and shot the gun for every frame that we were moving the mouse, which was a lot. We worked around this by adding a timer to limit the gun’s fire rate, which we checked every time the fire function was called. This way, even though the fire function was continuously called, actually shooting the gun was limited by the fire rate. We fixed the issue with not firing when we were holding down left click by setting a shooting flag to true when we left-clicked and setting it to false when we let go of left click. Then, for every frame, we fire the weapon if the shooting flag is true.</p>

						<p>Needless to say, we ran into many issues during this project.</p>
					</div>
				</div>
				<div class="row row-bottom-padded-md">
					<div class="col-md-10 animate-box" data-animate-effect="fadeInLeft">
						<h2 class="fh5co-heading">Lessons Learned</h2>
						<p>This project served as a brief excursion into the vast world of game development. We picked up a lot of different and unexpected skills along the way and followed a handful of different tutorials. We learned that applying the correct texturing and animating is a lot harder than it seems, especially adjusting the materials to get the correct texture and creating keyframes for animation. We also realized the importance of implementing realistic lightning, player movement, and creating an interactive game with clear objectives so that it feels realistic for the user. Finally, we learned how important it is to have efficient communication and collaboration when working on a project with so many different parts because as more features were added, it was imperative that we made sure that they would not break existing features. Ultimately, this experience proved to be an eye-opening journey into the life of a Valve employee. Now, we finally understand why CS2 has taken so long to develop.
</p>
					</div>
				</div>

				<div class="row row-bottom-padded-md">
					<div class="col-md-10 animate-box" data-animate-effect="fadeInLeft">
						<h2 class="fh5co-heading">Results</h2>
						<p>Results here</p>
</p>
					</div>
				</div>
				<div class="row row-bottom-padded-md">
					<div class="col-md-10 animate-box" data-animate-effect="fadeInLeft">
						<h2 class="fh5co-heading">References</h2>
						<ul>
							<li><a href="https://docs.godotengine.org/en/3.1/tutorials/3d/fps_tutorial/index.html" target="_blank">Godot FPS Tutorial</a></li>
							<li><a href="https://godotengine.org/article/fog-volumes-arrive-in-godot-4/" target="_blank">Fog Volumes in Godot article</a></li>
							<li><a href="https://advances.realtimerendering.com/s2014/wronski/bwronski_volumetric_fog_siggraph2014.pdf" target="_blank">Talk by Bartlomiej Wronski, “Volumetric Fog: Unified compute shader based solution to atmospheric scattering”</a></li>
							<li><a href="https://docs.godotengine.org/en/stable/getting_started/step_by_step/index.html" target="_blank">Godot documentation</a></li>
							<li><a href="https://ctwobosius.github.io/Deviant3D/" target="_blank">Deviant3D - past CS 184 project</a></li>
							<li><a href="https://www.youtube.com/watch?v=IV6XP-EDzw8&t=153s" target="_blank">FPS Animations in Blender</a></li>
							<li><a href="https://godotengine.org/article/multiplayer-in-godot-4-0-scene-replication/" target="_blank">Multiplayer in Godot</a></li>
						</ul>
					</div>
				</div>
				<div class="row row-bottom-padded-md">
					<div class="col-md-10 animate-box" data-animate-effect="fadeInLeft">
						<h2 class="fh5co-heading">Contributions</h2>
						<p><strong>Andrew Shen</strong></p>
						<ul>
							<li>Implemented smoke grenades using volumetric fog nodes recently added to Godot 4.0
</li>
							<li>Implemented flood fill algorithm to create space filling smoke grenades</li>
							<li>Implemented frag grenades that remove smokes</li>
							<li>Found shaders for realistic smokes</li>
							<li>Implemented bullet wakes, allowing bullets to separate the fog as in real life</li>
						</ul>
						<p><strong>Charles Liu</strong></p>
						<ul>
							<li>Made project proposal</li>
							<li>Created starter code for Godot project</li>
							<li>Implemented player movement and kinetics</li>
							<li>Implemented muzzle flash for weapon firing</li>
							<li>Created UI for multiplayer and player HUD</li>
							<li>Created game loop</li>
							<li>Implemented multiplayer spawning for players and grenades</li>
							<li>Added sound effects for weapon firing and reloading and grenades</li>
						</ul>
						<p><strong>Lena Kushigemachi</strong></p>
						<ul>
							<li>Created environment models and textures in Blender</li>
							<li>Researched asset models for characters and weapons</li>
							<li>Textured models in Blender</li>
							<li>Rigged and animated character models in Blender</li>
						</ul>
						<p><strong>Ryan Chan</strong></p>
						<ul>
							<li>Implemented raycasting for shooting physics and collision detection</li>
							<li>Implemented basic recoil when shooting</li>
							<li>Added bullet holes and reload logic</li>
							<li>Made deliverables for milestone and final webpages</li>
							<li>Made final video, rendered images, and created final presentation slides</li>
						</ul>
					</div>
				</div>
			</div>
	
	</div>

	<!-- jQuery -->
	<script src="js/jquery.min.js"></script>
	<!-- jQuery Easing -->
	<script src="js/jquery.easing.1.3.js"></script>
	<!-- Bootstrap -->
	<script src="js/bootstrap.min.js"></script>
	<!-- Waypoints -->
	<script src="js/jquery.waypoints.min.js"></script>
	<!-- Flexslider -->
	<script src="js/jquery.flexslider-min.js"></script>
	
	
	<!-- MAIN JS -->
	<script src="js/main.js"></script>

	</body>
</html>

